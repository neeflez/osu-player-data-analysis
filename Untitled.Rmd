---
title: "OsuPlayers test"
output: html_document
date: "2024-11-03"
---

Odczyt danych:
```{r}
file_path <- "osuPlayers.csv"
osu_data <- read.csv(file_path, header = TRUE, sep = ",")
osu_data$celnosc <- as.numeric(sub("%", "", osu_data$celnosc))
head(osu_data)
```
1. Analiza danych.
W naszej wstepnej analizie dzięki prostym działaniom na naszych danych odpowiemy sobie na kilka pytań. Spodziewamy się, że część graczy w swojej karierze dostało ban'a więc uwzględnienie takich graczy w naszej analizie może nieco zaburzyć wyniki. Wyeliminujemy więc wartości odstające, które jasno nam określą, których graczy powinniśmy odrzucić. Dodatkowo sprawdzimy korelację pomiędzy ilością medali, a celnością gracza. Wiekszość graczy zakłada, że gracze turniejowi, czyli gracze, którzy zdobywają największą ilość medali są bardziej "consistent" przez co mają większą celność. Sprawdzimy czy będzie to widać na naszych danych. Sprawdzimy również czy słynne hasło "play more", które oznacza, że gdy gramy więcej to osiągamy lepsze wyniki sprawdza się. Sprawdzimy, czy pewni gracze mogą borykać się z tzw. "mindblock'iem", który blokuje nas przed osiąganiem lepszych wyników.

#TODO: dodaj wiek graczy do naszej próbki danych zeby sprawdzic czy wiek tez wplywa na wyniki

1.1 Podstawowe statystyki
```{r}
summary(osu_data)
#odchylenia standardowe
sd(osu_data$`liczba.zagran`) 
sd(osu_data$`liczba.pp`)
```
Wyniki odchyleń standardowych liczby zagrań sugerują nam, że wśród naszej próbki danych są gracze, którzy dostali ban'a w swojej karierze. Znajdźmy takich graczy i wyeliminujmy ich z naszej analizy. Skorzystamy z wykresu scatter aby lepiej dostrzec, którzy gracze byli w przeszłości zbanowani.
```{r}
# Tworzenie wykresu rozrzutu
plot(osu_data$`liczba.zagran`, osu_data$`liczba.pp`, 
     xlab = "Liczba zagrań", ylab = "Liczba pp", 
     main = "Liczba zagrań vs liczba pp", pch = 19, col = "blue")

# Dodawanie nazw graczy do wykresu
text(osu_data$`liczba.zagran`, osu_data$`liczba.pp`, 
     labels = osu_data$`nazwa.gracza`, pos = 4, cex = 0.7, col = "red")

```
Jak widać na wykresie gracze "WhiteCat", "femboygaming" oraz "Chicony" mają nadzwyczaj małą ilość zagrań jak na graczy, którzy znajdują się w top 50 na świecie. Rzeczywiście tak jak zakładaliśmy są to osoby, które wcześniej były zbanowane, przez co mogą zaburzać naszą analizę. Odrzucimy ich aby, ich dane nie zaburzały naszej dalszej analizy. 
```{r}
osu_data <- subset(osu_data, !nazwa.gracza %in% c("WhiteCat", "femboygaming", "Chicony"))
```
Dodatkowo możemy zauważyć, że największe skupisko graczy najlepszych graczy na świecie jest wśród 150000 zagrań. Dobrze widać, też graczy, którzy pomimo bardzo dużej ilości zagrań nie mogą zdobyć większej ilości punktów pp. Są nimi: "Rafis", "sytho" oraz "kazamabc". Oczywiście może to wynikać z faktu, że ci gracze skupiają się bardziej na grze turniejowej niż, na zdobywaniu punktów pp. Sprawdźmy czy tak jest. Spójrzmy na stosunek zdobytych medali do ilości zagrań.
```{r}
# Wykres rozrzutu dla liczby medali a liczby zagrań
plot(osu_data$`liczba.zagran`, osu_data$`ilosc.medali`, 
     xlab = "Liczba zagrań", ylab = "Liczba medali", 
     main = "Liczba medali vs liczba zagrań", 
     pch = 19, col = "darkgreen", cex = osu_data$`liczba.zagran` / max(osu_data$`liczba.zagran`) * 2)

# Dodanie nazw graczy
text(osu_data$`liczba.zagran`, osu_data$`ilosc.medali`, 
     labels = osu_data$`nazwa.gracza`, pos = 4, cex = 0.7, col = "blue")
```
Niestety jak widać na powyższym wykresie. Gracze: "Rafis", "sytho" oraz "kazambc" nie są graczami turniejowymi, więc spędzają bardzo dużo czasu na grze a ich wyniki są kiepskie w porównaniu do reszty graczy. Na tym wykresie możemy również zauważyć, że zaczęli się wyróżniać inni gracze. "MALISZEWSKI", "FlyingTuna" oraz "xootynator" jak widać skupiają się głównie na graniu turnieji. Na poprzednim wykresie ciężko było znaleźć ich nazwy użytkownika.

Sprawdźmy teraz czy gracze turniejowi rzeczywiście posiadają większą celność, niż gracze, którzy skupiają się na zdobywaniu punktów pp.
```{r}
cor(osu_data$`liczba.zagran`, osu_data$`liczba.pp`)

```
Niska korelacja między liczbą zagrań a punktami pp. Oznacza to, że nie ma silnej zależności między liczbą zagrań a liczbą punktów pp. Innymi słowy, gracze, którzy grają więcej, niekoniecznie mają więcej punktów. Wydaje się, że inne czynniki mogą bardziej wpływać na osiągane wyniki, a liczba zagrań nie jest dobrym wskaźnikiem punktów. 

Oczywiście zakładamy w tym porównaniu, że celem każdego gracza jest zdobycie jak największej ilości punktów. Takie założenie może nie być trafne. Sprawdźmy czy gracze turniejowi dzięki poświęconemu wiekszemu czasu na gre mogą cieszyć się lepszymi wynikami.

```{r}
cor(osu_data$`ilosc.medali`, osu_data$`liczba.zagran`)
```
Niestety tutaj też nie możemy dostrzec tej zależnosci. Prawdopodobnie jest to spowodowane faktem, że graczy możemy podzielić na graczy turniejowych oraz graczy rankingowych. W dalszej części analizy za pomocą porządkowania liniowego danych postaramy się utworzyć własny ranking graczy i określić czy osoby wyżej w naszym rankingu przez poświęcenie większej ilości czasu na gre mają lepsze wyniki. Dodatkowo podczas analizy skupień podzielimy graczy na dwie grupy i wtedy sprawdzimy czy słynne hasło "play more" jest uzasadnione. 
```{r}
cor(osu_data$`ilosc.medali`, osu_data$`celnosc`)
```
Korelacja między liczbą medali a celnością jest umiarkowana i dodatnia co oznacza, że istnieje pewna zależność: gracze, którzy zdobywają więcej medali, mają tendencję do osiągania wyższej celności. Ten wynik jest zgodny z naszymi wcześniejszymi założeniami.

Aby zająć się dalszą analizą danych spróbujemy sobie zwizualizować nasze dane jeszcze na kilka sposobów aby lepiej je zrozumieć.
```{r}
hist(osu_data$`liczba.pp`, main="Rozkład punktów pp", xlab="Liczba pp")
```
Na powyższym histogramie widzimy rozkład punktów pp, który bardzo przypomina rozkład chi2. Nasz rozkład cechuje się dużą asymetrią prawostronną. Świadczy to o tym, że w rankingu top 50 mogą znajdować się gracze, którzy osiągają bardzo wysokie wyniki, co prowadzi do koncentracji danych w górnej części rozkładu. W takim przypadku, wiele osób może mieć wyniki bliskie średniej, a tylko nieliczni gracze osiągają wyniki znacznie powyżej średniej, co tworzy charakterystyczny kształt. Dodatkowo
punkty pp w osu! są obliczane na podstawie złożoności mapy, osiągniętych wyników oraz dokładności gracza. Taki system może sprzyjać tworzeniu większych wartości punktowych dla wybitnych graczy, co może skutkować kształtem asymetrią rozkładu.


```{r}
hist(osu_data$`liczba.zagran`, main="Rozkład liczby zagrań", xlab="Liczba zagrań")
```
Histogram rozkładu liczby zagrań pokazuje nam dobrze to co już zauważyliśmy wcześniej na wykresie scatter. Wiekszość graczy w top 50 posiada liczbę zagrań w okolicy 150000. Zakładając, że średnia długość jednego zagrania trwa 2min to aby osiągać wyniki wybitne trzeba poświęcić na gre co najmniej 5000 godzin czyli, aż 208 dni ciągłęgo grania.

```{r}
boxplot(osu_data$`celnosc`, main="Boxplot Celności", ylab="Celność (%)")
```
Na wykresie pudełkowym doskonale widać, że mediana celności graczy mieści się między 98%, a 98.5%. Obszar między kwartylem 3 a medianą jest widocznie większy od obszaru między kwartylem 1 a medianą. Świadczy to o tym, że jednak gracze w top50 w wiekszości maja wysoką celność. Oczywiście są też gracze o celności 97% oraz celności 99.5% ale są to nasze wartości odstające. Możemy zakładać, że 50% graczy posiada celność od 97.7% do 98.9%.

Podsumowując nasze wstępne analizy doszliśmy do takich wniosków:

- Eliminacja graczy zbanowanych: Wyeliminowanie graczy takich jak "WhiteCat", "femboygaming" i "Chicony", którzy mieli nadzwyczaj małą ilość zagrań, poprawiło jakość naszych danych. Umożliwiło to dokładniejsze zrozumienie wyników pozostałych graczy.

- Rozkład punktów pp: Rozkład punktów pp jest silnie asymetryczny, co sugeruje, że wśród najlepszych graczy znajdują się jednostki, które osiągają znacznie wyższe wyniki niż reszta. Wartości te mogą mieć duży wpływ na pozycje w rankingu, podczas gdy większość graczy osiąga wyniki bliskie średniej.

- Korelacje: Niska korelacja między liczbą zagrań a punktami pp sugeruje, że większa ilość zagrań nie przekłada się automatycznie na lepsze wyniki punktowe. Wydaje się, że inne czynniki, takie jak umiejętności i talent, mają większy wpływ na osiągane rezultaty. Z drugiej strony, umiarkowana korelacja między liczbą medali a celnością wskazuje, że gracze, którzy zdobywają więcej medali, zazwyczaj osiągają wyższe wyniki w celności, co potwierdza nasze wcześniejsze przypuszczenia.

- Rozkład liczby zagrań: Histogram pokazuje, że większość najlepszych graczy w top 50 ma liczbę zagrań w okolicy 150000. To może sugerować, że osiągnięcie wysokiego poziomu umiejętności wymaga dużego zaangażowania czasowego.

- Analiza celności: Boxplot celności pokazuje, że większość graczy w top 50 ma wysoką celność, z medianą między 98% a 98.5%. Oznacza to, że nawet wśród najlepszych graczy, występują wartości odstające, ale generalnie celność jest na bardzo wysokim poziomie.

- Kwestia "mindblocka" i strategii gry: wstępne przeanalizowanie danych sugeruje, że "play more" nie zawsze przekłada się na lepsze wyniki. Dalsze analizy, w tym analiza porządkowania liniowego oraz analizy skupień, pozwolą nam jasno odpowiedzieć na pytanie czy granie więcej oznacza lepsze wyniki.


W kolejnych krokach skupimy się na bardziej szczegółowej analizie, aby zbudować własny ranking graczy oraz utworzyć pewien podział naszych danych na graczy rankingowych oraz turniejowych.

2. Porządkowanie liniowe
Patrząc na poprzednie wnioski możemy zauważyć, że aktualny ranking jest złą miarą umiejętności gracza. Utworzymy teraz nowy ranking, który będzie uwzględniał większą ilość zmiennych.

Korzystając z zależności, że wykonanie najmniejszego błędu w jednym zagraniu skutkuje zmianą z oceny S na A, możemy utworzyć wskaźnik stresu. Będzie to stosunek ocen A do ocen S. W ten sposób za pomocą wskaźnika stresu sprawdzimy jak często gracze popełniają błędy w trakcie swoich zagrań. Tym wskaźnik stresu będzie niższy, tym sposób gry gracza będzie spokojniejszy. Skorzystamy z tego wskaźnika jako destymulanta. Chcemy aby wysoko w naszym rankingu byli gracze o niskim wskaźniku stresu.

Załóżmy, że najlepszym graczem będzie osoba o najwyższej liczbie: punktów pp, medali, celności, oraz o najniższej ilości: wskaźnika stresu, liczbie zagrań.

Dlaczego nie bierzemy pod uwagę Ocen SS? Ocena SS świadczy o celności jednego zagrania na 100%. W naszej analizie danych już bierzemy pod uwagę kryterium celności. Dodatkowo liczbą ocen SS można bardzo łatwo manipulować więc nie jest to miarodajny parametr w naszej analizie. 

Dlaczego liczbe zagrań traktujemy jako destymulantę? Chcemy faworyzować w naszym rankingu graczy, którzy w krótszym czasie osiągneli lepsze wyniki.

```{r}

# Dodanie kolumny wskaznik.radzenia.sobie.ze.stresem z zabezpieczeniem przed dzieleniem przez zero
osu_data$wskaznik.stresu <- with(osu_data, ifelse(Ocena.A == 0, NA,  Ocena.A / Ocena.S))


# Kopiujemy oryginalne dane, aby zachować je bez modyfikacji
osu_data_original <- osu_data

# Ustalmy stymulanty i destymulanty
stimulants <- c("celnosc", "liczba.pp", "ilosc.medali")
destimulants <- c("wskaznik.stresu", "liczba.zagran")

# 1. Przekształcenie destymulantów na stymulanty w kopii danych
osu_data[destimulants] <- lapply(osu_data[destimulants], function(x) max(x) - x)

# 2. Standaryzacja danych
standardized_data <- as.data.frame(scale(osu_data[, c(stimulants, destimulants)]))

# 3. Wyznaczenie wzorca
pattern <- apply(standardized_data, 2, max)

# 4. Obliczenie odległości euklidesowej od wzorca
distances <- apply(standardized_data, 1, function(row) sqrt(sum((row - pattern)^2)))

# 5. Miara Hellwiga
H_measure <- 1 - distances / max(distances)

# Dodanie miary Hellwiga do kopii oryginalnych danych
osu_data_original$Hellwig_measure <- H_measure

# Posortowanie danych według miary Hellwiga
osu_data_sorted <- osu_data_original[order(-osu_data_original$Hellwig_measure), ]

# Dodanie kolumny "nowy ranking" jako kolejność według miary Hellwiga
osu_data_sorted$nowy.ranking <- seq_len(nrow(osu_data_sorted))

# Utworzenie kolumny nowy_ranking
osu_data_sorted <- osu_data_sorted[, c("nowy.ranking", setdiff(names(osu_data_sorted), c("nowy.ranking", "ranking")))]


# Wyświetlenie wyników
print(osu_data_sorted,  row.names = FALSE)

```
Po zaimplementowaniu porządkowania liniowego na naszych danych możemy zauważyć, że na pierwszym miejscu widnieje gracz o nazwie użytkownika "MALISZEWSKI". Jest to bez wątpienia najlepszy zawodnik turniejowy, ponieważ posiada aż 55 medali. Jak widać poprzedni ranking niesłusznie faworyzuje graczy o największej ilości punktów pp. Oczywiście punkty pp to bardzo ważna stymulanta, która motywuje graczy do ciagłego progressu, natomiast faworyzowanie jej może być krzywdzące dla graczy o szerszych umiejętnościach niż tylko zdobywanie punktów.


3. Analiza skupień
```{r}

```